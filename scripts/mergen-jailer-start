#!/usr/bin/env bash
set -euo pipefail

VM_ID="${1:?vm id is required}"
VM_DIR="/etc/mergen/vm.d/${VM_ID}"
RUN_DIR="/run/mergen/${VM_ID}"

if [[ -f "${VM_DIR}/env" ]]; then
  # shellcheck disable=SC1090
  source "${VM_DIR}/env"
fi

mkdir -p "${RUN_DIR}"

# Placeholder start command:
# In production this should invoke jailer and firecracker binary.
if [[ -n "${MGN_SOCKET_PATH:-}" ]]; then
  : > "${MGN_SOCKET_PATH}.placeholder"
fi

echo "mergen placeholder started for ${VM_ID}"
sleep infinity

#!/usr/bin/env bash
set -euo pipefail

VM_ID="${1:?vm id is required}"
VM_DIR="/etc/mergen/vm.d/${VM_ID}"

# Minimal deterministic placeholder:
# - Read env file if present
# - Validate required metadata files exist
# Real implementation should create netns/tap and DNAT rules.
if [[ -f "${VM_DIR}/env" ]]; then
  # shellcheck disable=SC1090
  source "${VM_DIR}/env"
fi

if [[ ! -f "${VM_DIR}/meta.json" ]]; then
  echo "meta.json not found for ${VM_ID}" >&2
  exit 1
fi

exit 0
